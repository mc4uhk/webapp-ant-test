<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
      crossorigin="anonymous"
    />

    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="learn-jquery.css" />

    <link
      type="text/css"
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.css"
    />
    <link
      type="text/css"
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.css"
    />

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.js"
    ></script>
    <meta charset="UTF-8" />
    <title>CSS Position</title>

    <!-- 
        Reference
        jQuery Crash Course [1] - Intro & Selectors
        https://www.youtube.com/watch?v=3nrLc_JOF7k
     -->
  </head>
  <body>
    <div class="container">
      <div class="h1">
        <span class="badge bg-primary"> Hi </span>
      </div>
      <div id="pageWidth">123</div>

      <span
        class="d-inline-block"
        tabindex="0"
        data-bs-toggle="tooltip"
        title="Disabled tooltip"
      >
        <button
          class="btn btn-primary"
          style="pointer-events: none"
          type="button"
          disabled
        >
          Disabled button
        </button>
      </span>

      <button
        type="button"
        class="btn btn-secondary"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Tooltip on top"
      >
        Tooltip on top
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        data-bs-toggle="tooltip"
        data-bs-placement="right"
        title="Tooltip on right"
      >
        Tooltip on right
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        data-bs-toggle="tooltip"
        data-bs-placement="bottom"
        title="Tooltip on bottom"
      >
        Tooltip on bottom
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        data-bs-toggle="tooltip"
        data-bs-placement="left"
        title="Tooltip on left"
      >
        Tooltip on left
      </button>
    </div>

    <div class="container">
      <div class="row">
        <div class="button-panel">
          <img class="img-size" src="images/bird.svg" />
          <img class="img-size" src="images/dog.svg" />
          <img class="img-size" src="images/koala.svg" />
          <img class="img-size" src="images/tortoise.svg" />
        </div>
        <div>
          <span class="card-control" onclick="swapView()">swap</span>
          <span class="card-control" onclick="reset()" alt="reset">reset</span>
          <abbr title="help">help</abbr>
        </div>
      </div>

      <div class="main-content">
        <div id="sortable" class="top-left-panel"></div>
        <div class="bottom-right-panel"><div id="jsGrid"></div>
      </div>

    </div>


    <div class="container">
      <div class="row">
        <div class="col">
          1 of 2

          <div class="d-flex flex-column flex-wrap m-3"></div>
        </div>

        <div class="col">2 of 2</div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
      crossorigin="anonymous"
    ></script>
  </body>

  <script>
    //update field if click on Not the cell
    $(function () {
      $("#jsGrid").on("click", (args) => {
        console.log(args.target);
        if (!$(args.target).is("td") && !$(args.target).is("input")) {
          $("#jsGrid").jsGrid("updateItem");
        }
      });

      $("#sortable").sortable({
        deactivate: function (event, ui) {
          saveOrder();
        },
      });
      $("#sortable").disableSelection();
      restoreOrder();
      loadRemovedIds();
      loadOrientation();
    });

    function goSave() {}
    function goTest() {
      console.log("Test");
      console.log(JSON.stringify(clients));
    }

    var isEditing = false;
    var clients = [
      {
        Name: "Otto Clay",
        Age: 25,
        Country: 1,
        Address: "Ap #897-1459 Quam Avenue",
        Married: false,
        courses: [{ name: "Chinese" }, { name: "English" }, { name: "Math" }],
      },
      {
        Name: "Connor Johnston",
        Age: 45,
        Country: 2,
        Address: "Ap #370-4647 Dis Av.",
        Married: true,
      },
      {
        Name: "Lacey Hess",
        Age: 29,
        Country: 3,
        Address: "Ap #365-8835 Integer St.",
        Married: false,
      },
      {
        Name: "Timothy Henson",
        Age: 56,
        Country: 1,
        Address: "911-5143 Luctus Ave",
        Married: true,
      },
      {
        Name: "Ramona Benton",
        Age: 32,
        Country: 3,
        Address: "Ap #614-689 Vehicula Street",
        Married: false,
      },
    ];

    var countries = [
      { Name: "", Id: 0 },
      { Name: "United States", Id: 1 },
      { Name: "Canada", Id: 2 },
      { Name: "United Kingdom", Id: 3 },
    ];

    $("#jsGrid").jsGrid({
      width: "100%",
      height: "50%",

      editing: true,
      sorting: true,
      paging: true,

      data: clients,

      rowClick: function (args) {
        if (this._editingRow) this.updateItem();

        console.log(this._editingRow);
        console.log(args);
        console.log(args.item.Married);

        if (this.editing) {
          this.editItem($(args.event.target).closest("tr"));
        }
      },

      fields: [
        {
          name: "Name",
          type: "text",
          width: 150,
          validate: "required",
          editing: false,
        },
        { name: "Age", type: "number", width: 50, editing: true },
        { name: "Address", type: "text", width: 200, editing: true },
        {
          name: "Country",
          type: "select",
          items: countries,
          valueField: "Id",
          textField: "Name",
        },
        {
          name: "Married",
          type: "checkbox",
          title: "Is Married",
          sorting: false,
        },
      ],
    });

    function showSelected() {
      // clients.forEach((client, i) => console.log(client.Married ? i : ""));
      console.log(clients.filter((client) => client.Married));
    }

    var tooltipTriggerList = [].slice.call(
      document.querySelectorAll('[data-bs-toggle="tooltip"]')
    );
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    $(document).resize($("#pageWidth").html($(document).width()));

    function saveOrder() {
      var itemList = $("#sortable");
      var order = itemList.sortable("toArray").toString();
      console.log(order);
      localStorage.setItem("listOrder", order);
    }

    function restoreOrder() {
      var itemList = $("#sortable");
      var order = localStorage.getItem("listOrder");
      if (order) {
        $.each(order.split(","), function (i, id) {
          //appending the element with the ID given id should move each element to the end of the
          // list one after another, and at the end, the order should be restored.
          $("#" + id).appendTo(itemList);
        });
      }
    }

    var orientation;
    function loadOrientation() {
      orientation = localStorage.getItem("orientation");
      if(orientation == null)
          orientation='vert';
      setView(orientation);
    }

    function saveOrientation() {
      localStorage.setItem("orientation", orientation);
    }

    function insertCard(id, color) {
      let newCard = `<div id="${id}" class="card m-1 align-self-start card-size">
          <div class="card-body p-0">
            <div style="display: flex; background-color: ${color}; font-weight: bold;">
            <h5 class="card-title p-1" style="flex-grow:1">${id}</h5>
            <span class="card-control" style="padding-right:10px;" onclick="remove('${id}')">X</span>
            </div>
            <h6 class="card-subtitle mb-2 text-muted p-1">Card subtitle</h6>
            <p class="card-text p-1">
              Some quick example text to build on the card title and make up the
              bulk of the card's content.
            </p>
            <a href="#" class="card-link p-1">
              Card link
            </a>
            <a href="#" class="card-link">
              Another link
            </a>
          </div>
        </div>`;

      var itemList = $("#sortable");
      itemList.append(newCard);
    }

    function remove(id) {
      console.log(id);
      $("#" + id).fadeOut(1500, () => {
        $("#" + id).addClass('hidden')
        saveRemovedIds();
      });
    }

    function saveRemovedIds(){
      let ids= [];
       $(".hidden").each(function(){ ids.push(this.id); });
      console.log(ids);
      localStorage.setItem("removed-ids", ids);
    }

    function loadRemovedIds(){
      var removedIds = localStorage.getItem("removed-ids");
      if (removedIds) {
        $.each(removedIds.split(","), function (i, id) {
          $("#" + id).addClass("hidden");
        });
      }

    }

    insertCard("panel01", "#e0691f");
    insertCard("panel02", "#e0bd1f");
    insertCard("panel03", "#42e01f");
    insertCard("panel04", "#1fe0d0");
    insertCard("panel05", "#a6c797");
    insertCard("panel06", "#c193c2");
    insertCard("panel07", "#c2ab93");

    function reset(){
      localStorage.clear();
      location.reload();
    }

    function swapView(){
      orientation = orientation=='vert'?'hori':'vert';
      saveOrientation();

      $('.main-content').toggleClass("vert");
      $('.main-content').toggleClass("hori");
      $('.top-left-panel').toggleClass("vert");
      $('.top-left-panel').toggleClass("hori");
      $('.bottom-right-panel').toggleClass("vert");
      $('.bottom-right-panel').toggleClass("hori");
      $('.card-size').toggleClass("vert");
      $('.card-size').toggleClass("hori");
    }

    function setView(ori){
      $('.main-content').addClass(ori);
      $('.top-left-panel').addClass(ori);
      $('.bottom-right-panel').addClass(ori);
      $('.card-size').addClass(ori);
    }

  </script>

  <style>
    * {
      box-sizing: border-box;
    }

    .row {
      display: flex;
      flex-wrap: nowrap;
      background-color: cornsilk;
    }


    .main-content{
      display: flex;
      flex-wrap: nowrap;
      background-color: cornsilk;
    }

    .main-content.vert{
      flex-direction: row; 
    }

    .main-content.hori{
      flex-direction: column; 
    }

    .top-left-panel {
      display: flex;
      flex-wrap: wrap;
      flex-direction: column;
      max-height: 100vh;
      width: 40%;
       background-color: aqua; 
      align-content: flex-start;
    }

    .top-left-panel.vert {
      max-height: 100vh;
      width: 40%;
    }

    .top-left-panel.hori {
      max-height: 40vh;
      width: 100%;
    }

    .bottom-right-panel {
      background-color: cadetblue; 
      padding: 10px;
    }

    .bottom-right-panel.vert {
      flex-grow: 1;
      width: 50%;
    }

    .bottom-right-panel.hori {
      width: 100%;
    }




    .card-size.vert {
      width: 100%; /*vertical view*/
    }

    .card-size.hori {
      width: 18rem; /*horizontal*/
    }

    .card-control {
      cursor: pointer;
    }

    .img-size {
      margin: 5px;
      height: 50px;
    }

    .hidden {
    line-height:0; 
    height: 0; 
    overflow: hidden;
     padding: 0; 
     margin: 0; 
     border: 0;
     }

    @media (max-width: 800px) {
      * {
        margin: 0px;
      }
      .top-left-panel,
      .bottom-right-panel {
        width: 100%; /* The width is 100%, when the viewport is 800px or smaller */
        max-height: 100%;
      }
      .row {
        flex-wrap: wrap;
      }
      .card-size {
        width: 100%;
      }
    }
  </style>
</html>
